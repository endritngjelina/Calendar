<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Calendar & Task Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 80px;
        }
        
        .calendar-day:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .calendar-day.today {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            font-weight: 600;
        }
        
        .calendar-day.selected {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            font-weight: 600;
        }
        
        .calendar-day.other-month {
            opacity: 0.3;
        }
        
        .event-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin: 1px;
            display: inline-block;
        }
        
        .event-indicators {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 4px;
            max-width: 100%;
        }
        
        .priority-high { background: #ff4757; }
        .priority-medium { background: #ffa502; }
        .priority-low { background: #2ed573; }
        .priority-info { background: #3742fa; }
        
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
        }
        
        .btn-secondary {
            background: #e1e8ed;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #d1d9e0;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #c44569);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }
        
        .event-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .event-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .event-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .event-item.priority-high {
            border-left-color: #ff4757;
        }
        
        .event-item.priority-medium {
            border-left-color: #ffa502;
        }
        
        .event-item.priority-low {
            border-left-color: #2ed573;
        }
        
        .event-item.priority-info {
            border-left-color: #3742fa;
        }
        
        .event-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .event-time {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .event-description {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .event-actions {
            display: flex;
            gap: 10px;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stats-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-bar input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .view-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
        }
        
        .view-toggle button {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .view-toggle button.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        
        .three-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #2ed573, #17a2b8);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ff4757, #c44569);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .current-month {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 10px;
            padding: 0 10px;
        }
        
        .weekday {
            text-align: center;
            font-weight: 600;
            color: white;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .export-btn {
            background: linear-gradient(135deg, #5f27cd, #341f97);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(95, 39, 205, 0.4);
        }
    </style>
</head>
<body>
    <div class="three-bg" id="threeBg"></div>
    
    <div class="container mx-auto p-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2 text-shadow">
                <i class="fas fa-calendar-alt mr-3"></i>
                Advanced Calendar & Task Manager
            </h1>
            <p class="text-white text-lg opacity-90">Organize your life with style and efficiency</p>
        </div>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stats-card">
                <div class="stats-number" id="totalEvents">0</div>
                <div class="stats-label">Total Events</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="todayEvents">0</div>
                <div class="stats-label">Today's Events</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="weekEvents">0</div>
                <div class="stats-label">This Week</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="monthEvents">0</div>
                <div class="stats-label">This Month</div>
            </div>
        </div>
        
        <!-- Main Calendar Section -->
        <div class="glass-effect p-6 mb-8">
            <!-- View Toggle -->
            <div class="view-toggle">
                <button class="active" onclick="switchView('month')">
                    <i class="fas fa-calendar mr-2"></i>Month
                </button>
                <button onclick="switchView('week')">
                    <i class="fas fa-calendar-week mr-2"></i>Week
                </button>
                <button onclick="switchView('day')">
                    <i class="fas fa-calendar-day mr-2"></i>Day
                </button>
            </div>
            
            <!-- Calendar Header -->
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="previousPeriod()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="nav-btn" onclick="goToToday()">
                        <i class="fas fa-home"></i>
                    </button>
                    <button class="nav-btn" onclick="nextPeriod()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="current-month" id="currentMonth"></div>
                <div class="flex gap-3">
                    <button class="export-btn" onclick="exportCalendar()">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                    <button class="export-btn" onclick="importCalendar()">
                        <i class="fas fa-upload mr-2"></i>Import
                    </button>
                </div>
            </div>
            
            <!-- Weekday Headers -->
            <div class="weekday-header">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>
            
            <!-- Calendar Grid -->
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
        
        <!-- Search and Filters -->
        <div class="glass-effect p-6 mb-8">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search events..." onkeyup="searchEvents()">
            </div>
            
            <div class="flex flex-wrap gap-4 mb-4">
                <select id="priorityFilter" onchange="filterEvents()" class="px-4 py-2 rounded-lg border-2 border-gray-300">
                    <option value="">All Priorities</option>
                    <option value="high">High Priority</option>
                    <option value="medium">Medium Priority</option>
                    <option value="low">Low Priority</option>
                    <option value="info">Info</option>
                </select>
                
                <select id="categoryFilter" onchange="filterEvents()" class="px-4 py-2 rounded-lg border-2 border-gray-300">
                    <option value="">All Categories</option>
                    <option value="work">Work</option>
                    <option value="personal">Personal</option>
                    <option value="health">Health</option>
                    <option value="social">Social</option>
                    <option value="other">Other</option>
                </select>
                
                <button class="btn btn-secondary" onclick="clearFilters()">
                    <i class="fas fa-times mr-2"></i>Clear Filters
                </button>
            </div>
            
            <div class="event-list" id="eventList"></div>
        </div>
    </div>
    
    <!-- Floating Action Button -->
    <button class="floating-action-btn" onclick="openAddEventModal()">
        <i class="fas fa-plus"></i>
    </button>
    
    <!-- Add/Edit Event Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold" id="modalTitle">Add New Event</h2>
                <button class="text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventTitle">Event Title *</label>
                    <input type="text" id="eventTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="eventDescription">Description</label>
                    <textarea id="eventDescription" rows="3"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="eventDate">Date *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventTime">Time</label>
                        <input type="time" id="eventTime">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="eventPriority">Priority</label>
                        <select id="eventPriority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="info">Info</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventCategory">Category</label>
                        <select id="eventCategory">
                            <option value="personal">Personal</option>
                            <option value="work">Work</option>
                            <option value="health">Health</option>
                            <option value="social">Social</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="eventReminder">Reminder</label>
                    <select id="eventReminder">
                        <option value="">No Reminder</option>
                        <option value="15">15 minutes before</option>
                        <option value="30">30 minutes before</option>
                        <option value="60">1 hour before</option>
                        <option value="1440">1 day before</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="eventRecurrence">Repeat</label>
                    <select id="eventRecurrence">
                        <option value="">No Repeat</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>
                
                <div class="flex gap-3 mt-6">
                    <button type="submit" class="btn btn-primary flex-1">
                        <i class="fas fa-save mr-2"></i>Save Event
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Hidden file input for import -->
    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">
    
    <script>
        // Global variables
        let events = [];
        let currentDate = new Date();
        let selectedDate = null;
        let editingEvent = null;
        let currentView = 'month';
        let scene, camera, renderer;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initThreeJS();
            loadEvents();
            renderCalendar();
            updateStats();
            renderEventList();
            
            // Set today's date as default in form
            document.getElementById('eventDate').valueAsDate = new Date();
        });
        
        // Three.js background animation
        function initThreeJS() {
            const container = document.getElementById('threeBg');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            
            // Create floating particles
            const geometry = new THREE.SphereGeometry(0.5, 32, 32);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xffffff, 
                transparent: true, 
                opacity: 0.1 
            });
            
            for (let i = 0; i < 50; i++) {
                const particle = new THREE.Mesh(geometry, material);
                particle.position.set(
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200
                );
                scene.add(particle);
            }
            
            camera.position.z = 50;
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            scene.rotation.y += 0.001;
            renderer.render(scene, camera);
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Calendar rendering functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthElement = document.getElementById('currentMonth');
            
            // Update month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            monthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Clear existing calendar
            grid.innerHTML = '';
            
            // Get first day of the month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Generate calendar days
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.onclick = () => selectDate(date);
                
                // Add day number
                const dayNumber = document.createElement('div');
                dayNumber.textContent = date.getDate();
                dayNumber.style.fontWeight = '600';
                dayElement.appendChild(dayNumber);
                
                // Style different types of days
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                if (isToday(date)) {
                    dayElement.classList.add('today');
                }
                
                if (selectedDate && isSameDay(date, selectedDate)) {
                    dayElement.classList.add('selected');
                }
                
                // Add event indicators
                const dayEvents = getEventsForDate(date);
                if (dayEvents.length > 0) {
                    const indicators = document.createElement('div');
                    indicators.className = 'event-indicators';
                    
                    dayEvents.slice(0, 4).forEach(event => {
                        const indicator = document.createElement('div');
                        indicator.className = `event-indicator priority-${event.priority}`;
                        indicator.title = event.title;
                        indicators.appendChild(indicator);
                    });
                    
                    if (dayEvents.length > 4) {
                        const moreIndicator = document.createElement('div');
                        moreIndicator.className = 'text-xs text-gray-600 mt-1';
                        moreIndicator.textContent = `+${dayEvents.length - 4}`;
                        indicators.appendChild(moreIndicator);
                    }
                    
                    dayElement.appendChild(indicators);
                }
                
                grid.appendChild(dayElement);
            }
        }
        
        // Event management functions
        function openAddEventModal(date = null) {
            document.getElementById('modalTitle').textContent = 'Add New Event';
            document.getElementById('eventForm').reset();
            
            if (date) {
                document.getElementById('eventDate').valueAsDate = date;
            } else if (selectedDate) {
                document.getElementById('eventDate').valueAsDate = selectedDate;
            } else {
                document.getElementById('eventDate').valueAsDate = new Date();
            }
            
            editingEvent = null;
            document.getElementById('eventModal').style.display = 'flex';
        }
        
        function openEditEventModal(event) {
            document.getElementById('modalTitle').textContent = 'Edit Event';
            document.getElementById('eventTitle').value = event.title;
            document.getElementById('eventDescription').value = event.description || '';
            document.getElementById('eventDate').valueAsDate = new Date(event.date);
            document.getElementById('eventTime').value = event.time || '';
            document.getElementById('eventPriority').value = event.priority;
            document.getElementById('eventCategory').value = event.category;
            document.getElementById('eventReminder').value = event.reminder || '';
            document.getElementById('eventRecurrence').value = event.recurrence || '';
            
            editingEvent = event;
            document.getElementById('eventModal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('eventModal').style.display = 'none';
            editingEvent = null;
        }
        
        function saveEvent(eventData) {
            if (editingEvent) {
                // Update existing event
                const index = events.findIndex(e => e.id === editingEvent.id);
                if (index !== -1) {
                    events[index] = { ...eventData, id: editingEvent.id };
                    showNotification('Event updated successfully!', 'success');
                }
            } else {
                // Add new event
                eventData.id = Date.now().toString();
                events.push(eventData);
                showNotification('Event added successfully!', 'success');
            }
            
            saveEvents();
            renderCalendar();
            updateStats();
            renderEventList();
            closeModal();
        }
        
        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                events = events.filter(e => e.id !== eventId);
                saveEvents();
                renderCalendar();
                updateStats();
                renderEventList();
                showNotification('Event deleted successfully!', 'success');
            }
        }
        
        // Form submission handler
        document.getElementById('eventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const eventData = {
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                priority: document.getElementById('eventPriority').value,
                category: document.getElementById('eventCategory').value,
                reminder: document.getElementById('eventReminder').value,
                recurrence: document.getElementById('eventRecurrence').value,
                createdAt: editingEvent ? editingEvent.createdAt : new Date().toISOString()
            };
            
            saveEvent(eventData);
        });
        
        // Utility functions
        function selectDate(date) {
            selectedDate = new Date(date);
            renderCalendar();
            renderEventList();
        }
        
        function isToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() && 
                   date.getMonth() === today.getMonth() && 
                   date.getFullYear() === today.getFullYear();
        }
        
        function isSameDay(date1, date2) {
            return date1.getDate() === date2.getDate() && 
                   date1.getMonth() === date2.getMonth() && 
                   date1.getFullYear() === date2.getFullYear();
        }
        
        function getEventsForDate(date) {
            const dateString = date.toISOString().split('T')[0];
            return events.filter(event => event.date === dateString);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            const date = new Date();
            date.setHours(parseInt(hours), parseInt(minutes));
            return date.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }
        
        // Navigation functions
        function previousPeriod() {
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else if (currentView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else if (currentView === 'day') {
                currentDate.setDate(currentDate.getDate() - 1);
            }
            renderCalendar();
        }
        
        function nextPeriod() {
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() + 1);
            } else if (currentView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else if (currentView === 'day') {
                currentDate.setDate(currentDate.getDate() + 1);
            }
            renderCalendar();
        }
        
        function goToToday() {
            currentDate = new Date();
            selectedDate = new Date();
            renderCalendar();
            renderEventList();
        }
        
        function switchView(view) {
            currentView = view;
            
            // Update active button
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderCalendar();
        }
        
        // Statistics functions
        function updateStats() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            
            // Total events
            document.getElementById('totalEvents').textContent = events.length;
            
            // Today's events
            const todayEvents = events.filter(event => event.date === todayString);
            document.getElementById('todayEvents').textContent = todayEvents.length;
            
            // This week's events
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            const weekEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate >= weekStart && eventDate <= weekEnd;
            });
            document.getElementById('weekEvents').textContent = weekEvents.length;
            
            // This month's events
            const monthEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getMonth() === today.getMonth() && 
                       eventDate.getFullYear() === today.getFullYear();
            });
            document.getElementById('monthEvents').textContent = monthEvents.length;
        }
        
        // Event list rendering
        function renderEventList() {
            const eventList = document.getElementById('eventList');
            let eventsToShow = events;
            
            // Filter by selected date if any
            if (selectedDate) {
                const selectedDateString = selectedDate.toISOString().split('T')[0];
                eventsToShow = events.filter(event => event.date === selectedDateString);
            }
            
            // Apply search and filters
            eventsToShow = applyFilters(eventsToShow);
            
            // Sort events by date and time
            eventsToShow.sort((a, b) => {
                const dateCompare = new Date(a.date) - new Date(b.date);
                if (dateCompare !== 0) return dateCompare;
                
                const timeA = a.time || '00:00';
                const timeB = b.time || '00:00';
                return timeA.localeCompare(timeB);
            });
            
            if (eventsToShow.length === 0) {
                eventList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-calendar-times text-4xl mb-4"></i>
                        <p class="text-lg">No events found</p>
                        <p class="text-sm">Add some events to get started!</p>
                    </div>
                `;
                return;
            }
            
            eventList.innerHTML = eventsToShow.map(event => `
                <div class="event-item priority-${event.priority}">
                    <div class="event-title">${event.title}</div>
                    <div class="event-time">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        ${formatDate(event.date)}
                        ${event.time ? `<i class="fas fa-clock ml-4 mr-2"></i>${formatTime(event.time)}` : ''}
                    </div>
                    ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                    <div class="flex justify-between items-center mt-3">
                        <div class="flex gap-2">
                            <span class="px-2 py-1 rounded-full text-xs bg-gray-200 text-gray-700">
                                ${event.category}
                            </span>
                            <span class="px-2 py-1 rounded-full text-xs priority-${event.priority}" style="color: white;">
                                ${event.priority} priority
                            </span>
                        </div>
                        <div class="event-actions">
                            <button class="text-blue-500 hover:text-blue-700 mr-3" onclick="openEditEventModal(${JSON.stringify(event).replace(/"/g, '&quot;')})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700" onclick="deleteEvent('${event.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Search and filter functions
        function searchEvents() {
            renderEventList();
        }
        
        function filterEvents() {
            renderEventList();
        }
        
        function applyFilters(eventList) {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const priorityFilter = document.getElementById('priorityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            return eventList.filter(event => {
                const matchesSearch = !searchTerm || 
                    event.title.toLowerCase().includes(searchTerm) ||
                    (event.description && event.description.toLowerCase().includes(searchTerm));
                
                const matchesPriority = !priorityFilter || event.priority === priorityFilter;
                const matchesCategory = !categoryFilter || event.category === categoryFilter;
                
                return matchesSearch && matchesPriority && matchesCategory;
            });
        }
        
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            renderEventList();
        }
        
        // Import/Export functions
        function exportCalendar() {
            const dataStr = JSON.stringify(events, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `calendar-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification('Calendar exported successfully!', 'success');
        }
        
        function importCalendar() {
            document.getElementById('importFile').click();
        }
        
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedEvents = JSON.parse(e.target.result);
                    if (Array.isArray(importedEvents)) {
                        // Merge with existing events, avoiding duplicates
                        importedEvents.forEach(event => {
                            if (!events.find(e => e.id === event.id)) {
                                events.push(event);
                            }
                        });
                        saveEvents();
                        renderCalendar();
                        updateStats();
                        renderEventList();
                        showNotification('Calendar imported successfully!', 'success');
                    } else {
                        throw new Error('Invalid file format');
                    }
                } catch (error) {
                    showNotification('Error importing calendar: Invalid file format', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // Storage functions
        function saveEvents() {
            try {
                // Store in memory (localStorage not supported in Claude artifacts)
                window.calendarEvents = events;
            } catch (error) {
                showNotification('Error saving events', 'error');
            }
        }
        
        function loadEvents() {
            try {
                // Load from memory
                events = window.calendarEvents || [];
                
                // Add some sample events if none exist
                if (events.length === 0) {
                    const today = new Date();
                    const tomorrow = new Date(today);
                    tomorrow.setDate(today.getDate() + 1);
                    
                    events = [
                        {
                            id: '1',
                            title: 'Welcome to your Calendar!',
                            description: 'This is a sample event to get you started. Feel free to edit or delete it.',
                            date: today.toISOString().split('T')[0],
                            time: '09:00',
                            priority: 'medium',
                            category: 'personal',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: '2',
                            title: 'Team Meeting',
                            description: 'Weekly team sync-up meeting',
                            date: tomorrow.toISOString().split('T')[0],
                            time: '14:00',
                            priority: 'high',
                            category: 'work',
                            createdAt: new Date().toISOString()
                        }
                    ];
                    saveEvents();
                }
            } catch (error) {
                events = [];
                showNotification('Error loading events', 'error');
            }
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} mr-2"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'n':
                        e.preventDefault();
                        openAddEventModal();
                        break;
                    case 's':
                        e.preventDefault();
                        exportCalendar();
                        break;
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                closeModal();
            }
        });
        
        // Modal click outside to close
        document.getElementById('eventModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Auto-save form data as user types
        const formInputs = ['eventTitle', 'eventDescription', 'eventDate', 'eventTime'];
        formInputs.forEach(inputId => {
            document.getElementById(inputId).addEventListener('input', function() {
                // Simple auto-save simulation (in real app, this would save to localStorage)
                console.log('Auto-saving form data...');
            });
        });
        
        // Reminder notifications (simulation)
        function checkReminders() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const today = now.toISOString().split('T')[0];
            
            events.forEach(event => {
                if (event.date === today && event.time && event.reminder) {
                    const [hours, minutes] = event.time.split(':');
                    const eventTime = parseInt(hours) * 60 + parseInt(minutes);
                    const reminderTime = eventTime - parseInt(event.reminder);
                    
                    if (Math.abs(currentTime - reminderTime) < 1) {
                        showNotification(`Reminder: ${event.title} in ${event.reminder} minutes!`, 'info');
                    }
                }
            });
        }
        
        // Check for reminders every minute
        setInterval(checkReminders, 60000);
        
        // Add touch/swipe support for mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe left - next period
                    nextPeriod();
                } else {
                    // Swipe right - previous period
                    previousPeriod();
                }
            }
        }
        
        // Drag and drop functionality for events
        function enableDragDrop() {
            // This would be implemented for dragging events between dates
            console.log('Drag and drop functionality would be implemented here');
        }
        
        // Print functionality
        function printCalendar() {
            window.print();
        }
        
        // Add print styles
        const printStyles = `
            <style>
                @media print {
                    .floating-action-btn, .three-bg, .glass-effect {
                        display: none !important;
                    }
                    
                    body {
                        background: white !important;
                    }
                    
                    .calendar-day {
                        background: white !important;
                        border: 1px solid #ccc !important;
                    }
                }
            </style>
        `;
        
        document.head.insertAdjacentHTML('beforeend', printStyles);
        
        // Initialize tooltips for better UX
        function initTooltips() {
            const elementsWithTooltips = document.querySelectorAll('[title]');
            elementsWithTooltips.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    // Custom tooltip implementation would go here
                });
            });
        }
        
        // Performance optimization - debounce search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Apply debounce to search
        const debouncedSearch = debounce(searchEvents, 300);
        document.getElementById('searchInput').addEventListener('input', debouncedSearch);
        
        // Theme switching (could be extended)
        function switchTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            // Theme-specific styles would be applied via CSS
        }
        
        // Accessibility improvements
        function enhanceAccessibility() {
            // Add ARIA labels
            document.querySelectorAll('.calendar-day').forEach((day, index) => {
                day.setAttribute('role', 'button');
                day.setAttribute('tabindex', '0');
                day.setAttribute('aria-label', `Select date ${day.textContent}`);
            });
            
            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                const focusedElement = document.activeElement;
                if (focusedElement.classList.contains('calendar-day')) {
                    let newFocus;
                    switch (e.key) {
                        case 'ArrowRight':
                            newFocus = focusedElement.nextElementSibling;
                            break;
                        case 'ArrowLeft':
                            newFocus = focusedElement.previousElementSibling;
                            break;
                        case 'ArrowDown':
                            // Navigate to same day next week
                            const days = Array.from(document.querySelectorAll('.calendar-day'));
                            const currentIndex = days.indexOf(focusedElement);
                            newFocus = days[currentIndex + 7];
                            break;
                        case 'ArrowUp':
                            // Navigate to same day previous week
                            const daysUp = Array.from(document.querySelectorAll('.calendar-day'));
                            const currentIndexUp = daysUp.indexOf(focusedElement);
                            newFocus = daysUp[currentIndexUp - 7];
                            break;
                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            focusedElement.click();
                            break;
                    }
                    
                    if (newFocus) {
                        e.preventDefault();
                        newFocus.focus();
                    }
                }
            });
        }
        
        // Initialize accessibility features
        setTimeout(enhanceAccessibility, 100);
        
        // Advanced features that could be added:
        // - Recurring events generation
        // - Event categories with custom colors
        // - Time zone support
        // - Calendar sharing
        // - Integration with external calendars
        // - Email/SMS reminders
        // - Event templates
        // - Bulk operations
        // - Calendar views (agenda, timeline)
        // - Holiday integration
        // - Weather integration
        // - Analytics and insights
        
        console.log('Advanced Calendar & Task Manager loaded successfully!');
        console.log('Keyboard shortcuts: Ctrl+N (New Event), Ctrl+S (Export), Ctrl+F (Search), ESC (Close Modal)');
    </script>
</body>
</html>